<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>MDX Forms – Aufgaben</title>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-5xl mx-auto py-10">
    <!-- Header -->
    <header class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-2xl font-bold">MDX Forms</h1>
        <p class="text-sm text-gray-500">
          Eingeloggt als <span class="font-mono"><%= user.email %></span>
        </p>
      </div>
      <nav class="space-x-4 text-sm">
        <a href="/mdx" class="text-blue-600 hover:underline">Zurück zur Übersicht</a>
        <a href="/dashboard" class="text-gray-600 hover:underline">Dashboard</a>
        <a href="/users" class="text-gray-600 hover:underline">Users</a>
        <a href="/tenants" class="text-gray-600 hover:underline">Tenants</a>
        <a href="/logout" class="text-red-600 hover:underline">Logout</a>
      </nav>
    </header>

    <!-- Mir zugewiesene Aufgaben -->
    <section class="mb-10">
      <h2 class="text-xl font-semibold mb-4">Mir zugewiesene Aufgaben</h2>

      <% if (!assignedTasks || assignedTasks.length === 0) { %>
        <p class="text-gray-500 text-sm">
          Derzeit sind dir keine Aufgaben zugewiesen.
        </p>
      <% } else { %>
        <div class="space-y-4">
          <% assignedTasks.forEach(function(task) { %>
            <div class="bg-white rounded-xl shadow p-4 flex items-start justify-between">
              <div>
                <div class="text-xs uppercase tracking-wide text-gray-400 mb-1">Formular</div>
                <div class="font-semibold text-gray-900"><%= task.formTitle || task.slug %></div>
                <div class="text-xs text-gray-500 mb-2"><%= task.slug %></div>
                <div class="text-xs text-gray-500">
                  Angelegt am
                  <span class="font-mono">
                    <%= task.createdAtFormatted || task.createdAt %>
                  </span>
                </div>
              </div>

              <div class="flex flex-col items-end gap-2">
                <span class="inline-flex items-center rounded-full bg-blue-50 px-3 py-0.5 text-xs font-medium text-blue-700 border border-blue-100">
                  <%= task.status || "in_progress" %>
                </span>

                <div class="flex gap-2">
                  <a
                    href="/mdx/forms/<%= encodeURIComponent(task.slug) %>"
                    class="inline-flex items-center px-3 py-1.5 rounded-lg border border-gray-300 text-xs font-medium text-gray-700 bg-white hover:bg-gray-50"
                  >
                    Formular anzeigen
                  </a>

                  <a
                    href="/mdx/forms/<%= encodeURIComponent(task.slug) %>/submissions"
                    class="inline-flex items-center px-3 py-1.5 rounded-lg border border-gray-300 text-xs font-medium text-gray-700 bg-white hover:bg-gray-50"
                  >
                    Eingänge anzeigen
                  </a>

                  <form
                    method="post"
                    action="/mdx/tasks/<%= encodeURIComponent(task.id || task._id) %>/complete"
                  >
                    <button
                      type="submit"
                      class="inline-flex items-center px-3 py-1.5 rounded-lg bg-green-600 text-xs font-medium text-white hover:bg-green-700"
                    >
                      Als erledigt markieren
                    </button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </section>

    <!-- Offene, nicht zugewiesene Aufgaben -->
    <section>
      <h2 class="text-xl font-semibold mb-4">Offene, nicht zugewiesene Aufgaben</h2>

      <% if (!openTasks || openTasks.length === 0) { %>
        <p class="text-gray-500 text-sm">
          Es gibt derzeit keine offenen, nicht zugewiesenen Aufgaben.
        </p>
      <% } else { %>
        <div class="space-y-4">
          <% openTasks.forEach(function(task) { %>
            <div class="bg-white rounded-xl shadow p-4 flex items-start justify-between">
              <div>
                <div class="text-xs uppercase tracking-wide text-gray-400 mb-1">Formular</div>
                <div class="font-semibold text-gray-900"><%= task.formTitle || task.slug %></div>
                <div class="text-xs text-gray-500 mb-2"><%= task.slug %></div>
                <div class="text-xs text-gray-500">
                  Angelegt am
                  <span class="font-mono">
                    <%= task.createdAtFormatted || task.createdAt %>
                  </span>
                </div>
              </div>

              <div class="flex flex-col items-end gap-2">
                <span class="inline-flex items-center rounded-full bg-yellow-50 px-3 py-0.5 text-xs font-medium text-yellow-700 border border-yellow-100">
                  <%= task.status || "open" %>
                </span>

                <div class="flex gap-2">
                  <a
                    href="/mdx/forms/<%= encodeURIComponent(task.slug) %>"
                    class="inline-flex items-center px-3 py-1.5 rounded-lg border border-gray-300 text-xs font-medium text-gray-700 bg-white hover:bg-gray-50"
                  >
                    Formular anzeigen
                  </a>

                  <a
                    href="/mdx/forms/<%= encodeURIComponent(task.slug) %>/submissions"
                    class="inline-flex items-center px-3 py-1.5 rounded-lg border border-gray-300 text-xs font-medium text-gray-700 bg-white hover:bg-gray-50"
                  >
                    Eingänge anzeigen
                  </a>

                  <form
                    method="post"
                    action="/mdx/tasks/<%= encodeURIComponent(task.id || task._id) %>/claim"
                  >
                    <button
                      type="submit"
                      class="inline-flex items-center px-3 py-1.5 rounded-lg bg-blue-600 text-xs font-medium text-white hover:bg-blue-700"
                    >
                      Aufgabe übernehmen
                    </button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </section>
  </div>
</body>
</html>
